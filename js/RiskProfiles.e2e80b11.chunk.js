(this["webpackJsonpcheckout-prism-merchant-ui"]=this["webpackJsonpcheckout-prism-merchant-ui"]||[]).push([[9],{1228:function(e,t,n){"use strict";n.r(t);var s=n(1),i=n(8),r=n(0),a=n(547),c=n(5),l=n(451),o=n(487),d=n(576),u=n(484),b=n(2),j=n(596);var h=()=>Object(s.jsxs)("article",{children:[Object(s.jsxs)(d.a,{children:[Object(s.jsx)(b.TextHeadingTwo,{mb:2,children:"Overview"}),Object(s.jsx)(u.a,{children:"Risk profiles are a mechanism for scoring-based decision-making. It allows weighting multiple criteria simultaneously rather than one-by-one and having each of these criteria contribute to the final risk score. Risk profiles are best used for situations where very precise segmentation is difficult or impractical and so a segment can contain transactions of various risk levels."}),Object(s.jsx)(u.a,{children:"Every risk profile has two sections:"}),Object(s.jsxs)(j.a,{pl:3,children:[Object(s.jsx)(b.ListItem,{children:Object(s.jsx)(u.a,{children:"Scoring section (at the top of the page) where a risk score of a transaction is determined."})}),Object(s.jsx)(b.ListItem,{children:Object(s.jsx)(u.a,{children:"Decision section (at the bottom of the page) where a risk score is mapped to a specific decision."})})]})]}),Object(s.jsxs)(d.a,{children:[Object(s.jsx)(b.TextHeadingThree,{mb:2,color:"success",children:"Scoring section"}),Object(s.jsx)(u.a,{children:"The outcome of scoring is a number from 0 to 100 that represents a probability that a given transaction is fraudulent. So the lower the number the lower the risk."}),Object(s.jsx)(u.a,{children:"Scoring is based on rules. You can select as many rules as you want to be evaluated for every transaction that falls into a given risk profile. The order of the rules is not important. Every rule in a risk profile will be evaluated."}),Object(s.jsx)(u.a,{children:"A corresponding score is assigned to each rule. This score can be either a positive or a negative number. If a rule is true its score will increase or decrease the transaction risk score."}),Object(s.jsxs)(u.a,{children:["The ultimate risk score of a transaction is the sum of scores of all the rules that were found to be true for that transaction."," "]}),Object(s.jsxs)(u.a,{children:["Note: A transaction risk score must always be a number from 0 to 100. If the sum of rules' scores is less than 0 transaction\u2019s risk score will be set to 0. If the sum of rules' scores is greater than 100 transaction\u2019s risk score will be set to 100."," "]})]}),Object(s.jsxs)(d.a,{children:[Object(s.jsx)(b.TextHeadingThree,{mb:2,color:"success",children:"Decision section"}),Object(s.jsx)(u.a,{children:"In decision section you can select which decisions will be applicable for a given risk profile. The set of the decisions to chose from will depend on the risk profile type."}),Object(s.jsx)(u.a,{children:"Risk profile types correspond to Routing types:"}),Object(s.jsxs)(j.a,{pl:3,children:[Object(s.jsx)(b.ListItem,{children:Object(s.jsx)(u.a,{children:"Pre3DS"})}),Object(s.jsx)(b.ListItem,{children:Object(s.jsx)(u.a,{children:"PreAUTH (coming soon)"})}),Object(s.jsx)(b.ListItem,{children:Object(s.jsx)(u.a,{children:"PostAUTH (coming soon)"})})]}),Object(s.jsx)(u.a,{children:"Once the applicable decisions have been selected, you can define the risk score bands that correspond to them. For example, you may decide to Decline all transactions with risk score above 90 and to Force challenge all transactions with risk scores between 70 and 90."})]})]});var p=()=>Object(s.jsx)(o.b,{modalKey:l.a.RISK_PROFILE_INFO,title:"Risk profiles",children:Object(s.jsx)(h,{})});function O(){const e=Object(i.a)(["\n  display: grid;\n  grid-template-columns: 220px auto;\n  grid-gap: 12px;\n"]);return O=function(){return e},e}const x=Object(c.default)(b.Box)(O());var f=n(515),v=n(35),m=n(51);const g={[v.c.Pre3ds]:"Pre 3ds",[v.c.PostAuth]:"Post Auth"};var y=n(452);function E(){const e=Object(i.a)(["\n  word-wrap: break-word;\n"]);return E=function(){return e},e}const k=Object(c.default)(b.Box)(E());var S=({paymentProcessingStep:e,riskProfileSummaries:t})=>{const n=Object(y.a)(l.a.ADD_RISK_PROFILE).openModal;return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)(b.Text,{fontWeight:500,mb:2,children:g[e]}),0===t.length&&Object(s.jsx)(b.Box,{py:2,px:"12px",mb:2,children:Object(s.jsx)(b.Text,{fontSize:0,color:"base",children:"No Risk profiles"})}),t.map((t=>Object(s.jsx)(k,{children:Object(s.jsx)(m.b,{to:"/risk-profiles/".concat(e,"/").concat(t.id),display:"block","data-cy":"risk-profiles-link",children:t.name})},t.id))),Object(s.jsx)(b.Flex,{justifyContent:"center",mb:3,children:Object(s.jsx)(b.SecondaryButton,{onClick:()=>{n({mode:v.b.Add,paymentProcessingStep:e})},children:"Create new risk profile"})})]})},P=n(970),w=n(517);var R=()=>{const e=Object(f.e)(v.c.Pre3ds),t=e.status,n=e.data,i=e.error,r=Object(f.e)(v.c.PostAuth),a=r.status,c=r.data,l=r.error,o=i||l;return"loading"===t||"loading"===a?Object(s.jsx)(b.Panel,{as:"aside",p:0,px:3,py:3,children:Object(s.jsx)(P.a,{length:4})}):o?Object(s.jsx)(b.Panel,{as:"aside",p:0,px:3,pb:3,children:Object(s.jsx)(w.a,{children:"Error fetching risk profiles"})}):Object(s.jsxs)(b.Panel,{as:"aside",p:0,px:3,py:3,children:[Object(s.jsx)(b.Box,{mb:4,borderBottom:"baseLight.1",children:Object(s.jsx)(S,{paymentProcessingStep:v.c.Pre3ds,riskProfileSummaries:n.summaries})}),Object(s.jsx)(S,{paymentProcessingStep:v.c.PostAuth,riskProfileSummaries:c.summaries})]})},D=n(13),C=n(143),_=n(30),T=n(17),N=n.n(T),I=n(25),A=n(7),L=n(707),F=n(841),B=n(478),M=n(623),U=n(34),V=n(40);var H=()=>{const e=Object(r.useState)(null),t=Object(A.a)(e,2),n=t[0],i=t[1],a=Object(r.useState)(!1),c=Object(A.a)(a,2),o=c[0],d=c[1],u=Object(y.a)(l.a.DELETE_RISK_PROFILE),b=u.modalData,j=u.closeModal,h=Object(B.a)().showAlert,p=Object(D.useHistory)(),O=()=>{i(null),j()},x=()=>{h("Risk profile successfully deleted"),O(),U.b.invalidateQueries([V.a.riskProfiles,null===b||void 0===b?void 0:b.step]),p.replace("/risk-profiles")},v=Object(f.b)(x),m=Object(A.a)(v,1)[0];return b?Object(s.jsx)(M.a,{itemType:"Risk Profile",handleClose:O,submissionErrorMessage:n,loading:o,itemName:b.name,onCancel:O,onDelete:Object(I.a)(N.a.mark((function e(){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),e.prev=1,e.next=4,m("".concat(b.step,"/").concat(b.id));case 4:d(!1),x(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),409===(null===(t=e.t0.response)||void 0===t?void 0:t.status)?i("This risk profile is referenced in Routing and cannot be deleted."):i("Technical error. Please try again later."),d(!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))}):null},K=n(561),Y=n(18),z=n(653);var q=({onSuccess:e})=>{const t=Object(y.a)(l.a.RENAME_RISK_PROFILE),n=t.modalData,i=t.closeModal,r=Object(B.a)().showAlert,a=Object(f.c)((null===n||void 0===n?void 0:n.paymentProcessingStep)||""),c=Object(A.a)(a,1)[0];if(!n)return null;const o=n.paymentProcessingStep,d=n.name;return Object(s.jsx)(b.Modal,{type:"success",title:"Rename risk profile (".concat(g[o],")"),closeModal:i,children:Object(s.jsx)(z.a,{initialValues:{name:d},onSubmit:({data:e})=>c({data:e,path:"".concat(null===n||void 0===n?void 0:n.id,"/name")}),onCancel:i,onSuccess:t=>{r("Risk profile edited"),i(),e(t),U.b.invalidateQueries([V.a.riskProfiles,o])},deafultButtonText:"Rename"})})};var Q=()=>{const e=Object(y.a)(l.a.COPY_RISK_PROFILE),t=e.modalData,n=e.closeModal,i=Object(B.a)().showAlert,r=Object(D.useHistory)(),a=Object(f.a)((null===t||void 0===t?void 0:t.step)||""),c=Object(A.a)(a,1)[0],o=Object(f.f)(),d=Object(A.a)(o,1)[0],u=Object(f.b)((()=>{})),j=Object(A.a)(u,1)[0];if(!t)return null;const h=t.step,p=function(){var e=Object(I.a)(N.a.mark((function e(s){var a,l;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={score_decisions:t.state.decisions.map((e=>({decision:e.decision,end:e.end?e.end:null}))),scored_rules:t.state.scored_rules},e.next=3,c(s);case 3:if(!(l=e.sent)){e.next=16;break}return e.prev=5,e.next=8,d({data:a,path:"".concat(h,"/").concat(l.id,"/config")},{onSuccess:()=>{return e=l.id,i("Risk profile successfully duplicated"),n(),void r.push("/risk-profiles/".concat(null===t||void 0===t?void 0:t.step,"/").concat(e));var e}});case 8:U.b.invalidateQueries([V.a.riskProfiles,h]),e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(5),e.next=15,j("".concat(h,"/").concat(l.id));case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}();return Object(s.jsx)(b.Modal,{type:"success",title:"Duplicate risk profile (".concat(g[h],")"),closeModal:n,children:Object(s.jsx)(z.a,{onSubmit:p,onCancel:n,initialValues:{name:"".concat(t.state.name," copy")},deafultButtonText:"Duplicate"})})},W=n(485),G=n(530),J=n(45),$=n(842),Z=n(845);var X=({step:e,id:t,rulesData:n,riskProfileData:i})=>{const r=Object(J.a)().hasPermission,a=Object(f.f)(),c=Object(A.a)(a,1)[0],o=Object(B.a)().showAlert,d=Object(y.a)(l.a.DELETE_RISK_PROFILE).openModal,u=Object(y.a)(l.a.RENAME_RISK_PROFILE).openModal,j=Object(y.a)(l.a.COPY_RISK_PROFILE).openModal,h=Object($.a)(i),p=h.state,O=h.actions,x=function(){var n=Object(I.a)(N.a.mark((function n(){var s;return N.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,s={score_decisions:p.decisions.map((e=>({decision:e.decision,end:e.end?e.end:null}))),scored_rules:p.scored_rules},n.next=4,c({data:s,path:"".concat(e,"/").concat(t,"/config")});case 4:o("Successfully saved risk profile",{type:"success"}),O.handleSave(),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),o("Error saving risk profile",{type:"alert"});case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(){return n.apply(this,arguments)}}();return Object(s.jsxs)("main",{children:[Object(s.jsx)(Z.a,{when:p.hasEdited,promptKey:e=>e.pathname.includes("risk-profiles")?v.f.SwitchRiskProfilesSavePrompt:v.f.LeaveRiskProfilesSavePrompt}),r("prism:risk-profile:write")&&Object(s.jsx)(b.Panel,{mb:"12px",p:0,children:Object(s.jsxs)(K.a,{children:[Object(s.jsx)(K.b,{children:Object(s.jsx)(b.Box,{children:Object(s.jsxs)(b.Flex,{alignItems:"baseline",children:[Object(s.jsx)(b.TextHeadingTwo,{mr:2,children:"".concat(p.name)}),Object(s.jsx)(b.ClickableElement,{"data-cy":"edit-risk-profile-button",onClick:()=>u({paymentProcessingStep:e,id:t,name:p.name}),children:Object(s.jsx)(Y.i,{})})]})})}),Object(s.jsx)(K.c,{children:Object(s.jsxs)(G.a,{children:[Object(s.jsx)(b.AlertButton,{variant:"large",onClick:()=>{d({step:e,id:t,name:p.name})},children:"Delete risk profile"}),Object(s.jsx)(W.a,{enabled:p.hasEdited,text:"You cannot copy a risk profile with unsaved changes",children:Object(s.jsx)(b.Box,{mr:3,children:Object(s.jsx)(b.SecondaryButton,{variant:"large",disabled:p.hasEdited,onClick:()=>{j({step:e,state:p})},children:"Duplicate risk profile"})})}),Object(s.jsx)(b.PrimaryButton,{variant:"large",disabled:!p.hasEdited,onClick:x,"data-testid":"risk-profile-save-button",children:"Publish changes"})]})})]})}),Object(s.jsx)(b.Panel,{p:0,mb:3,children:Object(s.jsx)(F.a,{scoredRules:p.scored_rules,handleScoredRuleUpdate:O.handleScoredRuleChange,addScoringRule:O.handleAddScoredRule,handleDeleteRiskProfileRule:O.handleDeleteRiskProfileRule,rules:(null===n||void 0===n?void 0:n.summaries)||[],riskProfileName:p.name})}),Object(s.jsx)(b.Panel,{p:0,children:Object(s.jsx)(L.a,{decisions:p.decisions,handleUpdateScoringRange:O.handleDecisionChange,handleEnableDecision:O.handleEnableDecision,handleDisableDecision:O.handleDisableDecision,paymentProcessingStep:e})}),Object(s.jsx)(H,{}),Object(s.jsx)(q,{onSuccess:e=>{O.handleUpdateName(e.name)}}),Object(s.jsx)(Q,{})]})},ee=n(508),te=n(195);var ne=e=>{const t=Object(r.useState)(!1),n=Object(A.a)(t,2),s=n[0],i=n[1];return Object(r.useEffect)((()=>{i(!0)}),[e]),Object(r.useEffect)((()=>{i(!1)}),[s]),s};var se=()=>{const e=Object(D.useParams)(),t=e.step,n=e.id,i=Object(f.d)(t,n),r=i.data,a=i.status,c=i.error,l=i.isFetching,o=ne(l),d=Object(ee.d)(),u=d.data,j=d.status,h=d.error,p=!(!c&&!h);return"loading"===a||"loading"===j?Object(s.jsx)(b.Flex,{justifyContent:"center",children:Object(s.jsx)(_.b,{size:"large"})}):p?c&&Object(te.a)(c)?Object(s.jsx)(b.Flex,{justifyContent:"center",alignItems:"center",height:"calc(100vh - 120px)",children:Object(s.jsx)(C.a,{children:Object(s.jsx)(b.Text,{fontSize:1,lineHeight:1,children:"Looks like that risk profile doesnt exist"})})}):Object(s.jsx)(b.Flex,{justifyContent:"center",alignItems:"center",height:"calc(100vh - 120px)",children:Object(s.jsx)(C.a,{children:Object(s.jsxs)(b.Text,{fontSize:1,lineHeight:1,children:["Something went wrong. Please try again or you can get in touch with the support team at:",Object(s.jsx)(b.Link,{href:"mailto:prism-support@checkout.com",children:"prism-support@checkout.com"})]})})}):r&&u&&!o?Object(s.jsx)(X,{id:n,step:t,riskProfileData:r,rulesData:u}):null};var ie=()=>Object(s.jsx)("main",{children:Object(s.jsx)(b.Panel,{p:3,children:Object(s.jsx)(h,{})})});var re=()=>{const e=Object(y.a)(l.a.ADD_RISK_PROFILE),t=e.modalData,n=e.closeModal,i=Object(B.a)().showAlert,r=Object(D.useHistory)(),a=Object(f.a)((null===t||void 0===t?void 0:t.paymentProcessingStep)||"",(e=>{i("Risk profile created"),n(),U.b.invalidateQueries([V.a.riskProfiles,null===t||void 0===t?void 0:t.paymentProcessingStep]),r.push("/risk-profiles/".concat(null===t||void 0===t?void 0:t.paymentProcessingStep,"/").concat(e))})),c=Object(A.a)(a,1)[0];if(!t)return null;const o=t.paymentProcessingStep;return Object(s.jsx)(b.Modal,{type:"success",title:"Create new risk profile (".concat(g[o],")"),closeModal:n,children:Object(s.jsx)(z.a,{onSubmit:c,onCancel:n,initialValues:{name:""}})})},ae=n(529);function ce(){const e=Object(i.a)(["\n  height: calc(100vh - 120px);\n"]);return ce=function(){return e},e}const le=c.default.div(ce());t.default=()=>Object(s.jsxs)(a.a,{children:[Object(s.jsxs)(le,{children:[Object(s.jsx)(ae.a,{title:"Risk profiles",modalKey:l.a.RISK_PROFILE_INFO}),Object(s.jsxs)(x,{children:[Object(s.jsx)(R,{}),Object(s.jsxs)(D.Switch,{children:[Object(s.jsx)(D.Route,{path:"/risk-profiles/:step/:id",component:se}),Object(s.jsx)(D.Route,{path:"/risk-profiles",component:ie})]})]})]}),Object(s.jsx)(p,{}),Object(s.jsx)(re,{})]})},485:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var s=n(1),i=n(7),r=n(5),a=n(0),c=n(597),l=n(2),o=Object(r.default)(l.Box).withConfig({displayName:"TooltipButtonWrapper___StyledBox",componentId:"sc-1orezf7-0"})(["button{pointer-events:",";}"],(e=>e._css));var d=({text:e,children:t,enabled:n,defaultDirection:r="top"})=>{const l=Object(a.useState)(!1),d=Object(i.a)(l,2),u=d[0],b=d[1];return n&&e?Object(s.jsx)(c.a,{text:e,show:u,defaultDirection:r,children:Object(s.jsx)(o,{onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),_css:n?"none":"auto",children:t})}):Object(s.jsx)(s.Fragment,{children:t})}},515:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return o})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return j}));var s=n(34),i=n(56),r=n(40);const a=(e,t)=>{const n=Object(i.a)();return Object(s.e)([r.a.riskProfiles,t],(()=>n("".concat(r.a.riskProfilesStep(e),"/").concat(t))),{enabled:!!t})},c=e=>{const t=Object(i.a)();return Object(s.e)([r.a.riskProfiles,e],(()=>t(r.a.riskProfilesStep(e))))};var l=n(471);const o=()=>Object(l.a)("put",r.a.riskProfiles),d=(e,t)=>Object(l.a)("post",r.a.riskProfilesStep(e),{onSuccess:({id:e})=>{t&&t(e)}});var u=n(509);const b=e=>Object(u.a)(r.a.riskProfiles,{onSuccess:e}),j=(e,t=(()=>{}))=>Object(l.a)("put",r.a.riskProfilesStep(e),{onSuccess:t})},548:function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return u})),n.d(t,"c",(function(){return b})),n.d(t,"d",(function(){return h})),n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return O}));var s=n(140),i=n(35);const r=e=>Object.entries(e).map((([e,t])=>({value:{type:"decision",value:e},label:t}))),a={[i.e.Decline]:"Your transaction won't be processed. It will be sent neither to 3DS nor to Authorisation.",[i.e.Challenge]:"Your transaction will be routed via the 3DS workflow which means that will you be covered by the liability shift (on fraudulent grounds only).",[i.e.NoPreference]:"Your transaction will be routed via the 3DS workflow which means that will you be covered by the liability shift (on fraudulent grounds only).",[i.e.FrictionlessLiability]:"You will be requesting the Issuer to authenticate your transaction without using any challenge, which they may or may not accept.",[i.e.TryExemptions]:"Whenever possible, our intelligent 3DS routing engine will select the best PSD2 exemptions to downgrade your transaction."},c={[i.e.Decline]:"Decline",[i.e.Challenge]:"Force Challenge (liability shift)",[i.e.NoPreference]:"No Preference (liability shift)",[i.e.FrictionlessLiability]:"Try Frictionless (liability shift)",[i.e.TryExemptions]:"Try Exemptions"},l={[i.e.Decline]:"Decline",[i.e.Challenge]:"3ds check",[i.e.NoPreference]:"3ds check",[i.e.FrictionlessLiability]:"3ds check",[i.e.TryExemptions]:"Accept"},o=e=>({[s.a.One]:l,[s.a.Two]:c}[e]),d={[i.d.Capture]:"Capture",[i.d.Flag]:"Flag",[i.d.Void]:"Void"},u=e=>t=>"3DS1"!==e||![i.e.Challenge,i.e.FrictionlessLiability].includes(t),b=(e,t)=>o(t)[e]||d[e]||e,j={[i.d.Capture]:"",[i.d.Flag]:"Coming soon. Transaction will put on hold for manually review. You will be able to access flagged transactions and take decisions in the Payments tab. ",[i.d.Void]:""},h=(r(d),(e,t)=>{switch(e){case i.c.Pre3ds:return t===s.a.One?{displayValues:l,descriptions:a}:{displayValues:c,descriptions:a};case i.c.PostAuth:return{displayValues:d,descriptions:j}}}),p={[i.e.Decline]:1,[i.e.Challenge]:2,[i.e.NoPreference]:3,[i.e.FrictionlessLiability]:4,[i.e.TryExemptions]:5,[i.d.Void]:1,[i.d.Flag]:2,[i.d.Capture]:3},O={[i.e.Decline]:i.c.Pre3ds,[i.e.Challenge]:i.c.Pre3ds,[i.e.NoPreference]:i.c.Pre3ds,[i.e.FrictionlessLiability]:i.c.Pre3ds,[i.e.TryExemptions]:i.c.Pre3ds,[i.d.Void]:i.c.PostAuth,[i.d.Flag]:i.c.PostAuth,[i.d.Capture]:i.c.PostAuth}},578:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var s=n(1),i=n(17),r=n.n(i),a=n(25),c=n(7),l=n(0),o=n(466),d=n(657),u=n.n(d),b=n(2),j=n(546);var h=({options:e,label:t,name:n,placeholder:i,getItemLabel:d=(e=>e?e.label:""),getItemValue:h=(e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.value)&&void 0!==t?t:e})})=>{const p=Object(o.c)(n),O=Object(c.a)(p,3),x=O[1],f=O[2],v=f.setValue,m=f.setTouched,g=x.error,y=Object(o.d)(),E=y.submitCount,k=y.values,S=E>0&&void 0!==g,P=Object(l.useCallback)(function(){var e=Object(a.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(h(t));case 2:m(!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[h,m,v]),w=Object(l.useMemo)((()=>{var t;return null!==(t=e.find((e=>u()(h(e),k[n]))))&&void 0!==t?t:null}),[h,n,e,k]);return Object(s.jsxs)(s.Fragment,{children:[t&&Object(s.jsx)(b.FormLabel,{children:t}),Object(s.jsxs)(b.SelectMenu,{placeholder:i,onChange:P,selectedItem:w,itemToString:d,children:[Object(s.jsx)(b.SelectMenuButton,{hasErrors:S}),Object(s.jsx)(b.SelectMenuList,{children:e.map(((e,t)=>Object(s.jsx)(b.SelectMenuItem,{item:e,index:t},"formik-select-".concat(t))))})]}),S&&Object(s.jsx)(b.Box,{mt:2,children:Object(s.jsx)(j.a,{"data-testid":"".concat(n,"-error-messsage"),children:g})})]})}},596:function(e,t,n){"use strict";var s=n(8),i=n(5),r=n(2);function a(){const e=Object(s.a)(["\n  list-style: disc;\n"]);return a=function(){return e},e}const c=Object(i.default)(r.UnorderedList)(a());t.a=c},653:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var s=n(1),i=n(17),r=n.n(i),a=n(25),c=n(7),l=n(0),o=n(466),d=n(544),u=n(530),b=n(2),j=n(494);var h=Object(j.a)({name:[Object(j.g)("Name is required"),Object(j.e)(101,"Name must be 100 characters or under"),Object(j.c)(/^[0-9A-Za-z -]+$/,"Name can not contain invalid characters")]}),p=n(517);var O=({onSubmit:e,onCancel:t,onSuccess:n=(()=>{}),initialValues:i,deafultButtonText:j="Create"})=>{const O=Object(l.useState)(null),x=Object(c.a)(O,2),f=x[0],v=x[1];return Object(s.jsx)(o.b,{initialValues:i,validate:h,validateOnChange:!1,onSubmit:function(){var t=Object(a.a)(r.a.mark((function t(s,i){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,v(null),t.next=4,e({data:s});case 4:n(s),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),409===(null===(a=t.t0.response)||void 0===a?void 0:a.status)?v(' A risk profile named "'.concat(s.name,'" already exists')):v("Technical error. Please try again later.");case 10:return t.prev=10,i.setSubmitting(!1),t.finish(10);case 13:case"end":return t.stop()}}),t,null,[[0,7,10,13]])})));return function(e,n){return t.apply(this,arguments)}}(),children:({isSubmitting:e,submitCount:n})=>Object(s.jsxs)(o.a,{children:[Object(s.jsx)(d.a,{name:"name",label:"Risk profile name",mb:4,"data-testid":"risk-profile-create-name",placeholder:"Name of the risk profile",submitCount:n}),Object(s.jsxs)(u.a,{children:[Object(s.jsx)(b.PrimaryButton,{variant:"large",type:"submit",disabled:e,"data-cy":"submit",children:e?"Submitting":j}),Object(s.jsx)(b.OutlineButton,{variant:"large",onClick:t,children:"Cancel"})]}),f&&Object(s.jsx)(p.a,{children:f})]})})}},655:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var s=n(1),i=(n(0),n(2)),r=n(18),a=n(485);var c=({text:e,enabled:t=!0})=>Object(s.jsx)(i.Box,{ml:1,display:"inline-block",children:Object(s.jsx)(a.a,{enabled:t,text:e,children:Object(s.jsx)(r.l,{style:{verticalAlign:"bottom"}})})})},707:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var s=n(1),i=n(0),r=n.n(i),a=n(2),c=n(6),l=n(8),o=n(847),d=n(5);function u(){const e=Object(l.a)(["\n  position: absolute;\n  color: #1b2f37;\n  font-size: 14px;\n\n  top: ","px;\n"]);return u=function(){return e},e}function b(){const e=Object(l.a)(["\n  height: 16px;\n  width: 16px;\n  border-radius: 50%;\n  background-color: #778293;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  ","\n"]);return b=function(){return e},e}function j(){const e=Object(l.a)(["\n  height: 8px;\n  width: 100%;\n  border-radius: 4px;\n  align-self: center;\n  position: relative;\n\n  &::before {\n    content: '';\n    content: '';\n    width: 100%;\n    height: 2px;\n    background-color: #dfe7eb;\n    top: 2px;\n    position: absolute;\n    z-index: -1;\n  }\n"]);return j=function(){return e},e}const h=d.default.div(j()),p=d.default.div(b(),(({value:e,disabled:t})=>0===e||100===e||t?"\n      pointer-events: none;\n      background-color: #F2F4F5;\n      border: 1px solid #CFDBE1;\n      ":"")),O=d.default.div(u(),(({index:e})=>0===e?18:-18));var x=({start:e,end:t,disabled:n,onChange:i})=>t?Object(s.jsx)(o.Range,{values:[e,t],step:1,min:0,disabled:n,max:100,onChange:i,renderTrack:({props:n,children:i})=>Object(s.jsx)("div",{"data-testid":"decision-row-slider",onMouseDown:n.onMouseDown,onTouchStart:n.onTouchStart,style:Object(c.a)({},n.style),children:Object(s.jsx)(h,{ref:n.ref,style:{background:Object(o.getTrackBackground)({values:[e,t],colors:["transparent","#CFDBE1","transparent"],min:0,max:100})},children:i})}),renderThumb:({props:e,value:t,index:i})=>Object(s.jsx)(p,Object(c.a)(Object(c.a)({},e),{},{"data-testid":"decision-row-slider-thumb",disabled:n,value:t,style:Object(c.a)({},e.style),children:Object(s.jsx)(O,{index:i,children:t})}))}):null,f=n(45),v=n(485),m=n(655),g=n(548),y=n(140);var E=({decision:e,start:t,end:n,handleUpdateScoringRange:r,handleEnableDecision:c,handleDisableDecision:l,enabledCount:o,paymentProcessingStep:d})=>{const u=void 0!==n,b=Object(g.d)(d,y.a.Two),j=Object(i.useCallback)((t=>r({decision:e,values:t})),[e,r]),h=Object(f.a)().hasPermission;return Object(s.jsxs)("tr",{children:[Object(s.jsx)(a.TableCell,{children:Object(s.jsx)(v.a,{enabled:u&&o<=2,text:"At least two scoring decisions must be enabled",children:Object(s.jsx)(a.SwitchButton,{id:e,"data-testid":"decision-row-switch-button",checked:u,onChange:()=>u?l(e):c(e),disabled:u&&o<=2||!h("prism:risk-profile:write")})})}),Object(s.jsxs)(a.TableCell,{children:[b.displayValues[e]," ",""!==b.descriptions[e]&&Object(s.jsx)(m.a,{text:b.descriptions[e]})]}),Object(s.jsx)(a.TableCell,{id:"".concat(e,"_sliders"),children:u&&Object(s.jsx)(x,{disabled:!h("prism:risk-profile:write"),start:t,end:n,onChange:j})})]})};const k=(e,t)=>{const n=e[t-1];return n?n.end?n.end+1:k(e,t-1):0},S=({decisions:e,handleUpdateScoringRange:t,handleEnableDecision:n,handleDisableDecision:r,paymentProcessingStep:c})=>{const l=Object(i.useMemo)((()=>e.reduce(((e,t)=>t.end?e+1:e),0)),[e]);return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)(a.Box,{p:3,children:Object(s.jsx)("h1",{children:"Scoring decisions"})}),Object(s.jsx)(a.Box,{pr:"10px",pb:3,children:Object(s.jsxs)(a.Table,{children:[Object(s.jsx)(a.TableHead,{children:Object(s.jsxs)(a.TableRow,{children:[Object(s.jsx)(a.TableCell,{as:"th",width:"10%"}),Object(s.jsx)(a.TableCell,{as:"th",width:"40%",children:"Decision"}),Object(s.jsx)(a.TableCell,{as:"th",width:"50%",children:"Range"})]})}),Object(s.jsx)(a.TableBody,{children:e.map((({end:i,decision:a},o)=>Object(s.jsx)(E,{decision:a,start:k(e,o),end:i,handleUpdateScoringRange:t,handleEnableDecision:n,handleDisableDecision:r,enabledCount:l,paymentProcessingStep:c},a)))})]})})]})};var P=r.a.memo(S)},708:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var s=n(7),i=n(0);var r=class{constructor(e){this.value=void 0,this.next=void 0,this.prev=void 0,this.nextEnd=void 0,this.prevEnd=void 0,this.value=e,this.next=null,this.prev=null,this.nextEnd=null,this.prevEnd=null}findPrevEndNode(e=this.prev){return null===e?null:e.value.end?e:this.findPrevEndNode(e.prev)}findNextEndNode(e=this.next){return null===e?null:e.value.end?e:this.findNextEndNode(e.next)}pushOverlappingNextNodes(e=this,t=this.nextEnd){if(e&&t)return t.nextEnd&&t.value.end-2<=e.value.end&&(t.value.end=Math.min(t.value.end+2,98)),this.pushOverlappingNextNodes(t,t.nextEnd)}fixPreviousOverlappingNodes(e=this,t=this.prevEnd){if(!e||!t)return;const n=e.value.end-t.value.end;return e.prev&&n<2&&(t.value.end=t.value.end-2),this.fixPreviousOverlappingNodes(t,t.prevEnd)}previousNodesTouching(){let e=this.prevEnd,t=this.value.end;for(;e;){const n=t-e.value.end;if(!e.prevEnd&&e.value.end>2||n>2)return!1;t=e.value.end,e=e.prevEnd}return!0}touchingPreviousNode(){if(null===this.prevEnd)return!1;return this.value.end-this.prevEnd.value.end<=2}};var a=class{constructor(){this.head=void 0,this.endHead=void 0,this.endTail=void 0,this.tail=void 0,this.head=null,this.tail=null,this.endHead=null,this.endTail=null}add(e){const t=void 0!==e.end,n=new r(e);if(this.head||(this.head=n),!this.endHead&&t&&(this.endHead=n),this.tail&&(this.tail.next=n,n.prev=this.tail,t)){const e=n.findPrevEndNode();e&&(e.nextEnd=n),n.prevEnd=e,this.tail.nextEnd=n}t&&(this.endTail=n),this.tail=n}findByDecision(e){let t=this.head;for(;t;){if(t.value.decision===e)return t;t=t.next}return null}toArray(){let e=[],t=this.head;for(;t;)e.push(t.value),t=t.next;return e}toEndArray(){let e=[],t=this.endHead;for(;t;)e.push(t.value),t=t.nextEnd;return e}},c=n(6);var l=(e,t)=>{const n=new a;switch(e.decisions.forEach((e=>{n.add(e)})),t.type){case"UPDATE_DECISION":{const i=t.payload,r=i.decision,a=i.values,l=Object(s.a)(a,2),o=l[0],d=l[1],u=n.findByDecision(r);if(!u)return e;if(null===u.prevEnd){if(u.nextEnd&&d>=u.nextEnd.value.end-1)return e;u.value.end=d>0?d:1}else if(u.prevEnd&&u.nextEnd){if(u.prevEnd.prevEnd&&o<=u.prevEnd.prevEnd.value.end+2||u.nextEnd&&d>u.nextEnd.value.end-2||o===d)return e;u.prevEnd.value.end=o<2?1:o-1,u.value.end=d>98?98:d}else{const t=u.prevEnd.prevEnd&&o<=u.prevEnd.prevEnd.value.end+2,n=!u.prevEnd.prevEnd&&o<2,s=o>=100;if(t||n||s)return e;u.prevEnd.value.end=o-1}return Object(c.a)(Object(c.a)({},e),{},{decisions:n.toArray()})}case"ENABLE_DECISION":{const s=5,i=n.findByDecision(t.payload);if(null===i)return e;const r=i.findPrevEndNode(),a=i.findNextEndNode(),l=()=>{i.prevEnd=r,i.prev=r,i.nextEnd=a,r&&(r.nextEnd=i)};if(null===r){if(!a)return e;a.value.end<=s?i.value.end=1:i.value.end=s,a.prevEnd=i,i.nextEnd=a,i.pushOverlappingNextNodes()}else if(null===a)i.value.end=100,r.value.end=r.value.end-2,l(),i.fixPreviousOverlappingNodes();else if(r.prevEnd&&!r.touchingPreviousNode()||!r.prevEnd&&r.value.end>2)i.value.end=r.value.end,r.value.end=r.value.end-2,l(),a&&(a.prevEnd=i,a.prev=i);else if(r.previousNodesTouching()){const e=r.value.end+2;i.value.end=e,l(),a&&(a.prevEnd=i,a.prev=i),e>r.value.end&&i.pushOverlappingNextNodes()}else i.value.end=r.value.end,r.value.end=i.value.end-2,l(),a&&(a.prevEnd=i,a.prev=i),i.fixPreviousOverlappingNodes();return Object(c.a)(Object(c.a)({},e),{},{decisions:n.toArray()})}case"DISABLE_DECISION":{const s=n.findByDecision(t.payload);if(null===s)return e;const i=s.findPrevEndNode(),r=s.findNextEndNode();return!i&&r?r.prevEnd=null:!r&&i?(i.nextEnd=null,i.value.end=s.value.end):(i&&(i.nextEnd=r,i.value.end=s.value.end),r&&(r.prevEnd=i)),delete s.value.end,Object(c.a)(Object(c.a)({},e),{},{decisions:n.toArray()})}default:return e}},o=n(548);var d=(e,t)=>{const n=Object(i.useMemo)((()=>new a),[]),r=Object(i.useMemo)((()=>{return e.forEach((e=>{n.add(e)})),{decisions:(t=e,t.sort(((e,t)=>o.a[t.decision]-o.a[e.decision])))};var t}),[e,n]),c=Object(i.useReducer)(l,r),d=Object(s.a)(c,2),u=d[0],b=d[1];return{state:u,actions:Object(i.useMemo)((()=>({handleDecisionChange:e=>{b({type:"UPDATE_DECISION",payload:e}),t(!0)},handleEnableDecision:e=>{b({type:"ENABLE_DECISION",payload:e}),t(!0)},handleDisableDecision:e=>{b({type:"DISABLE_DECISION",payload:e}),t(!0)}})),[t])}}},841:function(e,t,n){"use strict";var s=n(1),i=n(22),r=n(0),a=n(2),c=n(18),l=n(45),o=n(621);const d=/^-?\d*\.?\d*$/;var u=({scoredRules:e,handleScoredRuleUpdate:t,handleDeleteRiskProfileRule:n})=>{const i=Object(l.a)().hasPermission;return Object(s.jsxs)(a.Table,{tableLayout:"fixed",children:[Object(s.jsx)(a.TableHead,{children:Object(s.jsxs)(a.TableRow,{children:[Object(s.jsx)(a.TableCell,{width:"75%",as:"th",children:"Rule name"}),Object(s.jsx)(a.TableCell,{width:"10%",as:"th",children:"Score"}),Object(s.jsx)(a.TableCell,{width:"15%",textAlign:"right",as:"th"})]})}),Object(s.jsx)(a.TableBody,{children:e.length>0?e.map(((e,r)=>Object(s.jsxs)(a.TableRow,{"data-cy":"risk-profile-scoring-rule",children:[Object(s.jsx)(a.TableCell,{children:e.name}),Object(s.jsx)(a.TableCell,{children:Object(s.jsx)(a.TextField,{type:"text","data-testid":"risk-profile-scoring-rules-table-text-field",disabled:!i("prism:risk-profile:write"),onChange:e=>{const n=e.target.value;d.test(n)&&t({index:r,score:n})},onBlur:e=>{""===e.target.value&&t({index:r,score:"0"})},color:Number(e.score)>0?"danger":"success",value:e.score})}),Object(s.jsx)(a.TableCell,{textAlign:"right",children:Object(s.jsx)(o.a,{onClick:()=>n(e)})})]},e.scoring_rule_id))):Object(s.jsx)(a.TableRow,{"data-cy":"risk-profile-rules-placeholder",children:Object(s.jsx)(a.TableCell,{colSpan:3,textAlign:"center",children:"No rules assigned to this risk profile"})})})]})},b=n(452),j=n(451),h=n(6),p=n(466),O=n(544),x=n(494),f=Object(x.a)({score:[Object(x.g)("Score is required"),Object(x.d)("Score must be an integer")],rule:[Object(x.h)("Rule is required")]}),v=n(578);var m=({onCancel:e,onSubmit:t,scoringRules:n})=>Object(s.jsx)(p.b,{initialValues:{score:"",rule:{id:"",name:"",tags:"",predicate:""}},onSubmit:e=>{const n=e.rule,s={score:e.score,scoring_rule_id:n.id,name:n.name};t(s)},validateOnChange:!0,validate:f,children:({submitCount:t})=>Object(s.jsxs)(p.a,{children:[Object(s.jsx)(a.Box,{mb:3,children:Object(s.jsx)(v.a,{name:"rule",options:n.map((e=>{e.tags;const t=Object(i.a)(e,["tags"]);return{label:t.name,value:Object(h.a)({},t)}})),label:"Rule",placeholder:"Please select a rule"})}),Object(s.jsx)(O.a,{label:"Score",mb:4,name:"score",type:"number",submitCount:t}),Object(s.jsxs)(a.Flex,{alignItems:"center",children:[Object(s.jsx)(a.Box,{children:Object(s.jsx)(a.PrimaryButton,{"data-cy":"modal-add-rule",type:"submit",children:"Assign rule"})}),Object(s.jsx)(a.Box,{pl:3,children:Object(s.jsx)(a.OutlineButton,{onClick:e,children:"Cancel"})})]})]})});var g=({addScoringRule:e,riskProfileName:t})=>{const n=Object(b.a)(j.a.ADD_RISK_PROFILE_SCORING_RULE),i=n.modalData,r=n.closeModal;return i?Object(s.jsx)(a.Modal,{type:"success",title:"Assign rule to ".concat(t),closeModal:r,children:Object(s.jsx)(m,{onCancel:r,onSubmit:t=>{e(t),r()},scoringRules:i})}):null},y=n(485),E=n(5);const k=Object(E.default)(c.a)((({theme:e})=>"\nmargin-right: ".concat(e.space[1],";\n")));t.a=({scoredRules:e,handleScoredRuleUpdate:t,addScoringRule:n,handleDeleteRiskProfileRule:c,rules:o,riskProfileName:d})=>{const h=Object(b.a)(j.a.ADD_RISK_PROFILE_SCORING_RULE).openModal,p=Object(r.useMemo)((()=>{const t=e.map((e=>e.scoring_rule_id));return o.filter((e=>!t.includes(e.id))).map((e=>{e.risk_profiles;return Object(i.a)(e,["risk_profiles"])}))}),[o,e]),O=((e,t)=>0===e.length?"No available rules, please create one":0===t.length?"All available rules have been attached to this risk profile":null)(o,p),x=Object(l.a)().hasPermission;return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)(a.Box,{mb:2,children:[Object(s.jsxs)(a.Flex,{p:3,justifyContent:"space-between",alignItems:"center",children:[Object(s.jsx)("h1",{children:"Scoring rules"}),Object(s.jsx)(y.a,{enabled:null!==O,text:O||"",children:x("prism:risk-profile:write")&&Object(s.jsxs)(a.SecondaryButton,{disabled:0===o.length||0===p.length,style:{pointerEvents:null!==O?"none":"auto"},onClick:()=>{h(p)},children:[Object(s.jsx)(k,{}),"Assign rule to ",d]})})]}),Object(s.jsx)(u,{scoredRules:e,handleScoredRuleUpdate:t,handleDeleteRiskProfileRule:c})]}),Object(s.jsx)(g,{addScoringRule:n,riskProfileName:d})]})}},842:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var s=n(6),i=n(7),r=n(0);var a=(e,t)=>{switch(t.type){case"UPDATE_SCORED_RULE":const n=t.payload,i=n.index,r=n.score,a=e.scored_rules[i];return Object(s.a)(Object(s.a)({},e),{},{scored_rules:e.scored_rules.map((e=>a.scoring_rule_id===e.scoring_rule_id?Object(s.a)(Object(s.a)({},a),{},{score:r}):e))});case"ADD_SCORED_RULE":return Object(s.a)(Object(s.a)({},e),{},{scored_rules:[...e.scored_rules,t.payload]});case"REMOVE_SCORED_RULE":return Object(s.a)(Object(s.a)({},e),{},{scored_rules:e.scored_rules.filter((e=>e.scoring_rule_id!==t.payload.scoring_rule_id))});case"UPDATE_NAME":return Object(s.a)(Object(s.a)({},e),{},{name:t.payload});default:return e}},c=n(708);var l=e=>{const t=Object(r.useState)(!1),n=Object(i.a)(t,2),l=n[0],o=n[1],d={name:e.name,scored_rules:e.scored_rules},u=Object(r.useReducer)(a,d),b=Object(i.a)(u,2),j=b[0],h=b[1],p=Object(c.a)(e.score_decisions,o),O=p.state,x=p.actions,f=Object(r.useMemo)((()=>Object(s.a)({handleSave:()=>{o(!1)},handleScoredRuleChange:e=>{h({type:"UPDATE_SCORED_RULE",payload:e}),o(!0)},handleAddScoredRule:e=>{h({type:"ADD_SCORED_RULE",payload:e}),o(!0)},handleDeleteRiskProfileRule:e=>{h({type:"REMOVE_SCORED_RULE",payload:e}),o(!0)},handleUpdateName:e=>{h({type:"UPDATE_NAME",payload:e})}},x)),[x]);return{state:Object(s.a)(Object(s.a)(Object(s.a)({},j),O),{},{hasEdited:l}),actions:f}}},845:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var s=n(1),i=n(0),r=n(13);var a=({when:e,promptKey:t,message:n="message"})=>{const a=Object(r.useLocation)().pathname,c=Object(i.useCallback)((t=>(e&&(t.preventDefault(),t.returnValue=n),e?n:"")),[n,e]);return Object(i.useEffect)((()=>(window.addEventListener("beforeunload",c),()=>window.removeEventListener("beforeunload",c))),[c]),Object(s.jsx)(r.Prompt,{when:e,message:e=>e.pathname!==a&&("function"===typeof t?t(e):t)})};n(144),n(107)}}]);
//# sourceMappingURL=RiskProfiles.e2e80b11.chunk.js.map